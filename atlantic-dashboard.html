<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Atlantic Division Dashboard</title>
  <link rel="stylesheet" href="oracle.css">
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    Atlantic Division Oracle Dashboard
  </header>

  <!-- NAVBAR -->
  <nav class="navbar">
    <ul>
      <li><a href="southeast-dashboard.html">Southeast</a></li>
      <li><a href="atlantic-dashboard.html" class="active">Atlantic</a></li>
      <li><a href="central-dashboard.html">Central</a></li>
      <li><a href="northwest-dashboard.html">Northwest</a></li>
      <li><a href="pacific-dashboard.html">Pacific</a></li>
      <li><a href="southwest-dashboard.html">Southwest</a></li>
    </ul>
  </nav>

  <!-- DASHBOARD CONTAINER -->
  <div class="dashboard-container">

    <!-- KPI ROW -->
    <div class="kpi-row" id="kpi-row"></div>

    <!-- CHART SECTION -->
    <div class="chart-section">
      <canvas id="atlanticChart"></canvas>
    </div>

    <!-- TEAM CARDS -->
    <div class="teams-container" id="oracle-output"></div>

  </div>

  <script>
    const atlanticTeams = [
      "Boston Celtics",
      "Brooklyn Nets",
      "New York Knicks",
      "Philadelphia 76ers",
      "Toronto Raptors"
    ];

    fetch('data/predictions.json')
      .then(response => response.json())
      .then(jsonData => {
        const container    = document.getElementById('oracle-output');
        const kpiContainer = document.getElementById('kpi-row');

        container.innerHTML    = '';
        kpiContainer.innerHTML = '';

        // Filter to Atlantic teams using correct JSON keys
        const data = jsonData
          .filter(item => item.TEAM_NAME && atlanticTeams.includes(item.TEAM_NAME))
          .map(item => ({
            team:        item.TEAM_NAME,
            season:      item.SEASON,
            probability: parseFloat(item['1_predicted_proba']) * 100,
            predicted:   item.MADE_PLAYOFFS_predicted,
            actual:      item.MADE_PLAYOFFS,
            wins:        item.W,
            losses:      item.L
          }));

        // Sort descending by probability
        data.sort((a, b) => b.probability - a.probability);

        // KPI Cards
        if (data.length > 0) {
          const topTeam      = data[0];
          const avgProb      = (data.reduce((sum, t) => sum + t.probability, 0) / data.length).toFixed(1);
          const playoffCount = data.filter(t => t.probability >= 50).length;

          kpiContainer.innerHTML = `
            <div class="kpi-card">
              <h4>Top Team</h4>
              <p>${topTeam.team}</p>
            </div>
            <div class="kpi-card">
              <h4>Average Playoff %</h4>
              <p>${avgProb}%</p>
            </div>
            <div class="kpi-card">
              <h4>Teams Likely Playoffs</h4>
              <p>${playoffCount}</p>
            </div>
            <div class="kpi-card">
              <h4>Total Records</h4>
              <p>${data.length}</p>
            </div>
          `;
        }

        // Team Cards
        data.forEach(pred => {
          const card = document.createElement('div');
          card.className = 'team-card';
          const logoPath = `assets/images/${pred.team.toLowerCase().replace(/\s/g, '-')}-logo.svg`;
          card.innerHTML = `
            <img src="${logoPath}" alt="${pred.team}" onerror="this.style.display='none'">
            <h3>${pred.team}</h3>
            <p>${pred.season}</p>
            <p>Playoff Prob: ${pred.probability.toFixed(1)}%</p>
            <p>${pred.wins}W â€“ ${pred.losses}L</p>
          `;
          container.appendChild(card);
        });

        // --- IMPROVED CHART: Grouped bars by season ---
        const seasons   = [...new Set(data.map(d => d.season))].sort();
        const teamNames = [...new Set(data.map(d => d.team))];

        const seasonColors = [
          'rgba(226,35,26,0.85)',
          'rgba(255,140,0,0.85)',
          'rgba(90,160,255,0.85)'
        ];

        const datasets = seasons.map((season, i) => ({
          label: season,
          data: teamNames.map(team => {
            const match = data.find(d => d.team === team && d.season === season);
            return match ? parseFloat(match.probability.toFixed(1)) : 0;
          }),
          backgroundColor: seasonColors[i] || 'rgba(150,150,150,0.7)',
          borderColor: 'rgba(255,255,255,0.25)',
          borderWidth: 1,
          borderRadius: 4
        }));

        const ctx = document.getElementById('atlanticChart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: teamNames,
            datasets: datasets
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: '#fff',
                  font: { size: 13, weight: 'bold' },
                  padding: 20,
                  usePointStyle: true,
                  pointStyle: 'rectRounded'
                }
              },
              tooltip: {
                callbacks: {
                  label: ctx => ` ${ctx.dataset.label}: ${ctx.parsed.y.toFixed(1)}%`
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                grid: { color: 'rgba(255,255,255,0.06)' },
                ticks: {
                  color: '#9aa3ae',
                  font: { size: 12 },
                  callback: val => val + '%'
                },
                title: {
                  display: true,
                  text: 'Playoff Probability (%)',
                  color: '#9aa3ae',
                  font: { size: 12 }
                }
              },
              x: {
                grid: { display: false },
                ticks: {
                  color: '#fff',
                  font: { size: 12, weight: 'bold' },
                  maxRotation: 20,
                  minRotation: 0
                }
              }
            }
          }
        });
      })
      .catch(err => console.error('Error loading JSON predictions:', err));
  </script>

</body>
</html>